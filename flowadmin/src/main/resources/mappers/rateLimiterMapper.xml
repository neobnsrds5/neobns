<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.neobns.admin.flowadmin.mapper.RateLimiterMapper">
    <select id="findByApplication" resultType="com.neobns.admin.flowadmin.dto.ratelimiter.RateLimiterSearchDto">
        SELECT r.id, a.application_name,r.url, r.type, r.limitForPeriod, r.limitRefreshPeriod, r.timeoutDuration
        FROM fwk_ratelimiter r, fwk_application a
        WHERE r.application_id = a.ID and application_id = #{id}
        ORDER BY type
    </select>

    <insert id="create" parameterType="com.neobns.admin.flowadmin.dto.ratelimiter.RateLimiterDto" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO fwk_ratelimiter(application_id, type, limitForPeriod, limitRefreshPeriod, timeoutDuration, url)
        VALUE (#{application_id}, #{type}, #{limitForPeriod}, #{limitRefreshPeriod}, #{timeoutDuration}, #{url})
    </insert>

    <delete id="delete">
        DELETE FROM fwk_ratelimiter
        WHERE id = #{id}
    </delete>

    <select id="findById" resultType="com.neobns.admin.flowadmin.dto.ratelimiter.RateLimiterDto">
        SELECT *
        FROM fwk_ratelimiter
        WHERE id=#{id}
    </select>

    <update id="update" parameterType="com.neobns.admin.flowadmin.dto.ratelimiter.RateLimiterDto">
        UPDATE fwk_ratelimiter
        SET limitForPeriod = #{limitForPeriod}, limitRefreshPeriod=#{limitRefreshPeriod}, timeoutDuration = #{timeoutDuration}
        WHERE id = #{id}
    </update>
</mapper>