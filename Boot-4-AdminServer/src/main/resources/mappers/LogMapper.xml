<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.neo.adminserver.mapper.LogMapper">

    <select id="findSlowByPage" resultType="LogDTO">
        SELECT * FROM logging_slow
        WHERE 1=1
        ORDER BY timestmp DESC
    	LIMIT #{limit} OFFSET #{offset}
    </select>

    <select id="findErrorByPage" resultType="LogDTO">
        SELECT * FROM logging_error
        WHERE 1=1
        ORDER BY timestmp DESC
    	LIMIT #{limit} OFFSET #{offset}
    </select>

    <select id="findByTraceId" parameterType="String" resultType="LogDTO">
        SELECT * FROM logging_event
        WHERE trace_id = #{traceId}
        ORDER BY timestmp
    </select>
    
    <select id="countSlowLogs" resultType="int">
        SELECT COUNT(*) FROM logging_slow
    </select>

    <select id="countErrorLogs" resultType="int">
        SELECT COUNT(*) FROM logging_error
    </select>
    
    <!-- logging_error 테이블 -->
    <select id="findErrorLogsByTraceId" parameterType="String" resultType="LogDTO">
        SELECT * FROM logging_error WHERE trace_id LIKE CONCAT('%', #{traceId}, '%')
        ORDER BY timestmp
    </select>
    <select id="findErrorLogsByUserId" parameterType="String" resultType="LogDTO">
        SELECT * FROM logging_error WHERE user_id LIKE CONCAT('%', #{userId}, '%')
        ORDER BY timestmp
    </select>
    <select id="findErrorLogsByIpAddress" parameterType="String" resultType="LogDTO">
        SELECT * FROM logging_error WHERE ip_address LIKE CONCAT('%', #{ipAddress}, '%')
        ORDER BY timestmp
    </select>
    <select id="findErrorLogsByURI" parameterType="String" resultType="LogDTO">
        SELECT * FROM logging_error WHERE query LIKE CONCAT('%', #{uri}, '%')
        ORDER BY timestmp
    </select>
    <select id="findErrorLogsByQuery" parameterType="String" resultType="LogDTO">
        SELECT * FROM logging_error WHERE query LIKE CONCAT('%', #{query}, '%')
        ORDER BY timestmp
    </select>

    <!-- logging_slow 테이블 -->
    <select id="findSlowLogsByTraceId" parameterType="String" resultType="LogDTO">
        SELECT * FROM logging_slow WHERE trace_id LIKE CONCAT('%', #{traceId}, '%')
        ORDER BY timestmp
    </select>
    <select id="findSlowLogsByUserId" parameterType="String" resultType="LogDTO">
        SELECT * FROM logging_slow WHERE user_id LIKE CONCAT('%', #{userId}, '%')
        ORDER BY timestmp
    </select>
    <select id="findSlowLogsByIpAddress" parameterType="String" resultType="LogDTO">
        SELECT * FROM logging_slow WHERE ip_address LIKE CONCAT('%', #{ipAddress}, '%')
        ORDER BY timestmp
    </select>
    <select id="findSlowLogsByQuery" parameterType="String" resultType="LogDTO">
        SELECT * FROM logging_slow WHERE query LIKE CONCAT('%', #{query}, '%')
        ORDER BY timestmp
    </select>
        <select id="findSlowLogsByURI" parameterType="String" resultType="LogDTO">
        SELECT * FROM logging_slow WHERE query LIKE CONCAT('%', #{uri}, '%')
        ORDER BY timestmp
    </select>

</mapper>
