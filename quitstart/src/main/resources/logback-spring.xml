<?xml version="1.0" encoding="UTF-8" ?>
<configuration>
	<!-- 콘솔에 로그 출력 -->
	<appender name="CONSOLE"
		class="ch.qos.logback.core.ConsoleAppender">
		<encoder>
			<pattern>%d{yyyy-MM-dd HH:mm:ss} [%thread] [%X{requestId}] %-5level %logger{36} - %msg%n</pattern>
		</encoder>
	</appender>

	<!-- 데이터베이스에 로그 저장 -->
	<appender name="DB"
		class="ch.qos.logback.classic.db.DBAppender">
		<filter class="ch.qos.logback.core.filter.EvaluatorFilter">
			<evaluator>
				<expression>logger.contains("com.example.neobns.logging.common.LoggingAspect")
					||
					logger.contains("com.example.neobns.logging.common.MybatisLoggingInterceptor")
					||
					logger.contains("com.example.neobns.logging.common.RestTemplateLoggingInterceptor")
				</expression>
			</evaluator>
			<onMatch>ACCEPT</onMatch>
			<onMismatch>DENY</onMismatch>
		</filter>
		<connectionSource
			class="ch.qos.logback.core.db.DriverManagerConnectionSource">
			<driverClass>com.mysql.cj.jdbc.Driver</driverClass>
			<url>jdbc:mysql://localhost:3306/db2</url>
			<user>root</user>
			<password>1234</password>
		</connectionSource>
	</appender>

	<appender name="FILE" class="ch.qos.logback.core.FileAppender">
		<!-- 로그를 저장할 파일 경로 -->
		<file>logs/application.log</file> <!-- 로그가 저장될 파일 경로 설정 -->

		<!-- 필터 설정 (DB와 동일) -->
		<filter class="ch.qos.logback.core.filter.EvaluatorFilter">
			<evaluator>
				<expression>logger.contains("com.example.neobns.logging.common.LoggingAspect")
					||
					logger.contains("com.example.neobns.logging.common.MybatisLoggingInterceptor")
					||
					logger.contains("com.example.neobns.logging.common.RestTemplateLoggingInterceptor")
				</expression>
			</evaluator>
			<onMatch>ACCEPT</onMatch>
			<onMismatch>DENY</onMismatch>
		</filter>

		<!-- 로그 형식 설정 -->
		<encoder>
			<pattern>%d{yyyy-MM-dd HH:mm:ss}; %logger{}; %level{}; %thread{}; %msg%n</pattern> <!-- 로그의 날짜 및 메시지 포맷 -->
		</encoder>
	</appender>

	<!-- 루트 로거 -->
	<root level="info">
		<appender-ref ref="CONSOLE" />
		<appender-ref ref="DB" />
		<appender-ref ref="FILE" />
	</root>
</configuration>